

## 01- 什么是事务 ? 

事务就是用户定义的一系列数据库操作，这些操作可以视为一个完成的逻辑处理工作单元，要么全部执行，要么全部不执行，是不可分割的工作单元



## 02- 事务的特性有哪些 ?

- 原子性（Atomicity）

  > 事务的原子性保证事务中包含的一组更新操作是原子的，不可分割的，不可分割是事务最小的工作单位，所包含的操作被视为一个整体，执行过程中遵循“要么全部执行，要不都不执行”，不存在一半执行，一半未执行的情况。
  
- 一致性(Consistency)

  > 事务的一致性要求事务必须满足数据库的完整性约束，且事务执行完毕后会将数据库由一个一致性的状态变为另一个一致性的状态。事务的一致性与原子性是密不可分的，如银行转账的例子 A账户向B账户转1000元钱，首先A账户减去1000元钱，然后B账户增加1000元钱，这两动作是一个整体，失去任何一个操作数据的一致性状态都会遭到破坏，所以这两个动作是一个整体，要么全部操作，要么都不执行，可见事务的一致性与原子性息息相关。
  
- 隔离性(Isolation)

  > 事务的隔离性要求事务之间是彼此独立的，隔离的。及一个事务的执行不可以被其他事务干扰。具体到操作是指一个事务的操作必须在一个事务commit之后才可以进行操作。多事务并发执行时，相当于将并发事务变成串行事务，顺序执行，如同串行调度般的执行事务。这里可以思考事务如何保证它的可串行化的呢？答案锁，接下来会讲到。
  
- 持续性(Durability)

  > 事物的持续性也称持久性，是指一个事务一旦提交，它对数据库的改变将是永久性的，因为数据刷进了物理磁盘了，其他操作将不会对它产生任何影响。

## 03- 如果不考虑隔离性会引发什么问题 ? 

如果不考虑事务的隔离性，会发生的几种问题：

- 脏读

  > 脏读是指在一个事务处理过程中读取了另一个未提交的事务中的数据。

- 不可重复读

  > 不可重复读是指对于数据库中的某个数据，一个事务内多次查询却返回了不同的数据值，这是由于在事务执行过程中，数据被另一个事务修改并提交了。

- 幻读

  > 幻读是事务非独立执行时发生的一种现象。例如，事务T1对一个表中所有的行的某个字段做了从“1”修改为“2”的操作，这时事务T2又插入了一条新的记录，而该字段的值为“1”并且提交给数据库。这时，操作事务T1的用户如果再查看刚刚修改的数据，会发现还有一行没有修改，其实这行是从事务T2中添加的，就好像产生幻觉一样，这就是产生了幻读。
  >
  > 幻读和不可重复读都是读取了另一条已经提交的事务，所不同的是不可重复读查询的都是同一个数据项，而幻读针对的是一批数据（比如数据的个数）。



## 04- 如何解决上述问题 ? 

**可以通过调整事务的隔离级别解决上述问题**

- **read uncommitted** : 读取尚未提交的数据 ：哪个问题都不能解决

- **read committed**：读取已经提交的数据 ：可以解决脏读  ---- oracle、sql server、postgresql 默认的

- **repeatable read**：重读读取：可以解决脏读 和 不可重复读  ---mysql默认的

- **serializable：**串行化：可以解决 脏读 不可重复读 和 虚读 ---相当于锁表



## 05- 事务隔离级别是怎么实现的 , 你有了解过嘛 ? 

隔离级别的实现主要有读写锁和MVCC( Multi-Version Concurrency Control )多版本并发处理方式。

- 读未提交，它是性能最好，也可以说它是最野蛮的方式，因为它压根儿就不加锁，所以根本谈不上什么隔离效果，可以理解为没有隔离。

- 串行化。读的时候加共享锁，也就是其他事务可以并发读，但是不能写。写的时候加排它锁，其他事务不能并发写也不能并发读。

- 读提交和可重复读。这两种隔离级别是比较复杂的，既要允许一定的并发，又想要兼顾的解决问题。为了实现这种权衡 MySQL 采用了 MVVC (多版本并发控制) 的方式。

  

## 06- 你们项目中事务问题是如何控制的 ?  

我最近做的一个项目是分布式项目 , 这个项目中的事物问题分二种情况 : 

- 如果业务没有涉及到多个服务的调用, 直接使用Spring的声明式事物进行控制,  做法就是在需要事物的业务方法上添加@Transational注解
- 如果业务涉及到多个访问的调用 , 使用阿里巴巴开源的seata进行事物控制



## 07- 在你的项目中哪些模块使用了分布式事务控制 ? 能否举例说明 ?

我最近做的项目中很多地方都使用到了分布式事物  ,  例如 : 

**功能一 :** 

在用户实名认证审核功能中, 用户实名认证审核通过需要做二个操作 

1. 调用自媒体微服务创建自媒体帐号
2. 修改用户微服务实名认证审核的数据状态

这个业务中涉及到了多个服务的调用, 为了 保证数据的一致性 , 使用了分布式事物控制



**功能二 :** 

在文章审核发布的案例中, 文章审核通过后 , 会调用文章微服务发布文章 , 同时调用自媒体微服务修改文章的发布状态 , 也涉及到了多个服务之间的调用 , 所以需要使用分布式事务



**功能三 :** 

在自媒体用户发布文章的功能中, 文章发布成功之后需要调用阿里云进行审核, 阿里云审核通过之后需要修改自媒体服务的文章状态 , 同时需要发布延迟任务 ,为了保证服务数据的一致性 , 这里也使用了分布式事务



## 08- 你在这个模块中使用了Seata的哪种模式 ? 为什么选择这种模式, 其他模式能不能用 ? 





## 09- 你们使用了Seata AT模式, 那你对Seat AT模式的工作原理有了解过嘛 ? 其他模式的流程呢 ?





## 10- 什么是TCC模式的 业务悬挂 和 空回滚  ? 如何解决业务悬挂 和 空回滚 ?









